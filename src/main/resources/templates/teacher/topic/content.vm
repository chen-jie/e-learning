<!DOCTYPE html>
<html>
<head>
    <title>E-learning</title>

    #parse("common/head.vm")
    <link rel="stylesheet" href="/static/css/2.css" media="all"/>
    <style>
        .content{
            background-color: white;
        }
        .detail-box {
            margin-bottom: 15px;
            padding: 20px;
        }
        .jieda li {
            position: relative;
            padding: 20px 0 10px;
            border-bottom: 1px dotted #DFDFDF;
        }
    </style>
</head>

<body style="background-color: #e2e2e2;">
    #if($!msg)
    <script>
        layer.msg('$msg');
    </script>
    #end

<div class="main layui-clear">
    <div class="wrap">
        <div class="content detail">
            <div class="fly-panel detail-box">
                <h1>$!topic.title</h1>
                <div class="fly-tip fly-detail-hint" data-id="51" style="height: 20px;">
                    #if($!topic.isTop == 1)
                        <span class="fly-tip-stick">置顶帖 </span>
                    #end
                    <div class="fly-list-hint">
                        <i class="layui-icon">&#xe63a;</i> $!topic.replyCount                        <i class="layui-icon">&#xe643;</i> $!topic.viewCount
                    </div>
                </div>
                <div class="detail-about fly-tip">
                    <a class="jie-user" href="">
                        #if($!user.roleId == 2)
                            <span class="fly-tip-jie">教师</span>
                        #end
                        <cite>
                            $!topic.author                            <em>$date.format('yyyy-MM-dd HH:mm:ss',$!topic.createTime)</em>
                        </cite>
                    </a>
                </div>
                <div class="photos" style="margin-top: 20px;margin-bottom: 20px;overflow: hidden">
                    $!topic.content
                </div>
            </div>
            <div style="height: 20px;background-color:#e2e2e2; "></div>
            <div class="fly-panel detail-box fly-tip" style="padding-top: 0;">
                <a name="comment"></a>
                <ul class="jieda photos" id="jieda">
                    #foreach($reply in $replies)
                        <li class="jieda-daan">
                            <a name="item-49"></a>
                            <div class="detail-about detail-about-reply">
                                <a class="jie-user" href="javascript:void(0);" style="display: block;height: 46px;">
                                    #if($!reply.roleId == 2)
                                        <span class="fly-tip-jie">教师</span>
                                    #end
                                    <cite>
                                        <i>$!reply.username</i>
                                        #if($!reply.userId == $!topic.authorId)
                                            <em>(楼主)</em>
                                        #end
                                        #if($!user.roleId == 2)
                                            <button class="layui-btn layui-btn-mini layui-btn-danger" onclick="deleteReply($!reply.id)">删除这条回复</button>
                                        #elseif($!reply.userId == $!user.id)
                                            <button class="layui-btn layui-btn-mini layui-btn-danger" onclick="deleteReply($!reply.id)">删除这条回复</button>
                                        #end
                                    </cite>
                                </a>
                                <div class="detail-hits">
                                    $date.format('yyyy-MM-dd HH:mm:ss',$!reply.createTime)
                                </div>
                            </div>
                            <div class="detail-body jieda-body">
                                $!reply.content
                            </div>
                        </li>
                    #end

                </ul>

                <div class="layui-form layui-form-pane">
                    <form action="/topic/addReply" method="post">
                        <div class="layui-form-item layui-form-text">
                            <textarea id="demo" name="content"></textarea>
                        </div>
                        <div id="replay_user"></div>
                        <div class="layui-form-item">
                            <input type="hidden" name="topicId" value="$!topic.id">
                            <button class="layui-btn" lay-filter="*" lay-submit="">提交回答</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

</body>
<script src="/static/layui/layui.js"></script>
<script>
    layui.use('layedit', function () {
        var layedit = layui.layedit;
        layedit.build('demo', {
            tool: ['strong' //加粗
                , 'italic' //斜体
                , 'underline' //下划线
                , 'del' //删除线

                , '|' //分割线

                , 'left' //左对齐
                , 'center' //居中对齐
                , 'right' //右对齐
                , 'link' //超链接
                , 'unlink' //清除链接
                , 'face' //表情
            ],
            height:200
        }); //建立编辑器
    });
    function deleteReply(id) {
        layer.confirm("确定要删除吗?",{icon:3,title:'提示'},function(){
            $.post("/teacher/topic/deleteReply/"+id,function (res) {
                if(res.status === 0) {
                    layer.alert(res.msg,function(){
                        layer.closeAll();
                        window.location.reload();
                    });
                } else {
                    layer.alert(res.msg);
                }
            },'json');
        })
    }
</script>
</html>